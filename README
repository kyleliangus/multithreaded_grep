A patch for the mulithreaded implementaiton proposed by Zev Weiss.